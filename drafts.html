<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MORSTRIX | –ê—Ä—Ö—ñ–≤ (Pixel Art)</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #000000; /* –ß–æ—Ä–Ω–∏–π —Ñ–æ–Ω */
            --grid-color: #004d40; /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω–∏–π –¥–ª—è —Å—ñ—Ç–∫–∏ */
            --text-color: #00ff00; /* –Ø—Å–∫—Ä–∞–≤–æ-–∑–µ–ª–µ–Ω–∏–π –¥–ª—è —Ç–µ–∫—Å—Ç—É (Pixel) */
            --accent-color: #ff00ff; /* –ú–∞–¥–∂–µ–Ω—Ç–∞ –¥–ª—è –∞–∫—Ü–µ–Ω—Ç—É (Retro) */
            --cell-size: 80px;
        }

        body {
            font-family: 'Press Start 2P', monospace; /* –Ü–¥–µ–∞–ª—å–Ω–∏–π –¥–ª—è –ø—ñ–∫—Å–µ–ª—å–∞—Ä—Ç—É */
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            touch-action: pan-y; /* –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å–∫—Ä–æ–ª—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
            image-rendering: pixelated;
        }
        
        /* –Ø–∫—â–æ –Ω–µ–º–∞—î —à—Ä–∏—Ñ—Ç—É 'Press Start 2P', –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω–∏–π */
        @supports not (font-family: 'Press Start 2P') {
             body {
                font-family: monospace;
            }
        }

        .header {
            text-align: center;
            padding: 10px;
            background-color: var(--grid-color);
            color: #fff;
            box-shadow: 0 4px 0 var(--accent-color);
            margin-bottom: 5px;
            text-shadow: 2px 2px 0 #000;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(var(--cell-size), 1fr));
            gap: 1px; /* –Ü–º—ñ—Ç–∞—Ü—ñ—è —Ç–æ–Ω–∫–æ—ó —Å—ñ—Ç–∫–∏ */
            padding: 10px;
            background-color: var(--grid-color); /* –ö–æ–ª—ñ—Ä –º—ñ–∂ –∫–ª—ñ—Ç–∏–Ω–∫–∞–º–∏ */
        }

        .cell {
            min-height: var(--cell-size);
            background-color: var(--bg-color);
            border: 1px solid var(--grid-color);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.1s;
            text-align: center;
            padding: 5px;
            font-size: 10px;
        }

        .cell:hover {
            background-color: #001a14;
        }

        .note-indicator {
            color: var(--accent-color);
            font-size: 14px;
            text-shadow: 1px 1px 0 #000;
            margin-top: 5px;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ "–ö—ñ–º–Ω–∞—Ç–∏" */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none; /* –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            width: 90%;
            max-width: 500px;
            background: var(--bg-color);
            border: 2px solid var(--text-color);
            padding: 20px;
            box-shadow: 4px 4px 0 var(--accent-color);
        }

        textarea {
            width: 100%;
            height: 200px;
            background-color: #000000;
            color: var(--text-color);
            border: 1px solid var(--grid-color);
            padding: 10px;
            box-sizing: border-box;
            resize: none;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .close-btn, .save-btn {
            background-color: var(--accent-color);
            color: var(--bg-color);
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            margin-top: 10px;
            font-family: inherit;
            font-size: 12px;
            box-shadow: 2px 2px 0 #000;
        }
        
        .save-btn {
            background-color: var(--text-color);
        }
    </style>
    </head>
<body>

    <div class="header">
        MORSTRIX ARCHIVE V1.0
    </div>

    <div id="grid-container" class="grid-container">
        </div>

    <div id="noteModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">–ö—ñ–º–Ω–∞—Ç–∞ [X, Y]</h2>
            <textarea id="noteContent" placeholder="–¢—É—Ç –≤–∞—à—ñ –Ω–æ—Ç–∞—Ç–∫–∏, –∞—Ä—Ç–∏ —á–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."></textarea>
            <button id="saveNoteBtn" class="save-btn">–ó–ë–ï–†–ï–ì–¢–ò</button>
            <button id="closeModalBtn" class="close-btn">–ó–ê–ö–†–ò–¢–ò</button>
        </div>
    </div>

    <script>
        const GRID_SIZE = 5; // –°—Ç–≤–æ—Ä—é—î–º–æ —Å—ñ—Ç–∫—É 5x5
        const gridContainer = document.getElementById('grid-container');
        const noteModal = document.getElementById('noteModal');
        const modalTitle = document.getElementById('modalTitle');
        const noteContent = document.getElementById('noteContent');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');

        let currentCellKey = null;

        // ----------------------------------------------------
        // üíæ LOCAL STORAGE –§–£–ù–ö–¶–Ü–á
        // ----------------------------------------------------

        /**
         * –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –≤—Å—ñ –Ω–æ—Ç–∞—Ç–∫–∏ –∑ Local Storage.
         * @returns {Object} –û–±'—î–∫—Ç, –¥–µ –∫–ª—é—á - —Ü–µ ID –∫–ª—ñ—Ç–∏–Ω–∫–∏ (–Ω–∞–ø—Ä., 'cell_2_3'), –∑–Ω–∞—á–µ–Ω–Ω—è - —Ç–µ–∫—Å—Ç.
         */
        function loadNotes() {
            try {
                const data = localStorage.getItem('morstrix_drafts');
                return data ? JSON.parse(data) : {};
            } catch (e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è LocalStorage:", e);
                return {};
            }
        }

        /**
         * –ó–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ –Ω–æ—Ç–∞—Ç–∫–∏ —É Local Storage.
         * @param {Object} notes –û–±'—î–∫—Ç –Ω–æ—Ç–∞—Ç–æ–∫ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
         */
        function saveNotes(notes) {
            try {
                localStorage.setItem('morstrix_drafts', JSON.stringify(notes));
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                }
            } catch (e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è LocalStorage:", e);
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
                }
            }
        }

        // ----------------------------------------------------
        // üèóÔ∏è –ì–ï–ù–ï–†–ê–¶–Ü–Ø –°–Ü–¢–ö–ò –¢–ê –õ–û–ì–Ü–ö–ê
        // ----------------------------------------------------
        
        const allNotes = loadNotes();

        function generateGrid() {
            gridContainer.innerHTML = '';
            for (let row = 1; row <= GRID_SIZE; row++) {
                for (let col = 1; col <= GRID_SIZE; col++) {
                    const cellKey = `cell_${row}_${col}`;
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'cell';
                    cellDiv.dataset.key = cellKey;
                    
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –Ω–æ—Ç–∞—Ç–∫–∏ –¥–ª—è —Ü—ñ—î—ó –∫–ª—ñ—Ç–∏–Ω–∫–∏
                    const hasNote = !!allNotes[cellKey] && allNotes[cellKey].trim() !== '';

                    cellDiv.innerHTML = `[${row}, ${col}] ${hasNote ? '<div class="note-indicator">‚ö°Ô∏è</div>' : ''}`;
                    cellDiv.addEventListener('click', () => openCell(cellKey, row, col));
                    gridContainer.appendChild(cellDiv);
                }
            }
        }

        function openCell(cellKey, row, col) {
            currentCellKey = cellKey;
            modalTitle.textContent = `–ö—ñ–º–Ω–∞—Ç–∞ [${row}, ${col}]`;
            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó –∫–ª—ñ—Ç–∏–Ω–∫–∏
            noteContent.value = allNotes[cellKey] || '';
            noteModal.style.display = 'flex';
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.expand(); // –†–æ–∑–≥–æ—Ä—Ç–∞—î–º–æ Web App –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω
            }
        }

        function saveAndClose() {
            if (currentCellKey) {
                const content = noteContent.value.trim();
                if (content === '') {
                    delete allNotes[currentCellKey]; // –í–∏–¥–∞–ª—è—î–º–æ, —è–∫—â–æ –ø—É—Å—Ç–æ
                } else {
                    allNotes[currentCellKey] = content;
                }
                saveNotes(allNotes); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —É Local Storage
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–ª—ñ—Ç–∏–Ω–∫–∏
                const currentCellDiv = document.querySelector(`.cell[data-key="${currentCellKey}"]`);
                if (currentCellDiv) {
                    const hasNote = !!allNotes[currentCellKey];
                    currentCellDiv.innerHTML = `[${currentCellKey.split('_')[1]}, ${currentCellKey.split('_')[2]}] ${hasNote ? '<div class="note-indicator">‚ö°Ô∏è</div>' : ''}`;
                }

                currentCellKey = null;
            }
            noteModal.style.display = 'none';
        }

        // ----------------------------------------------------
        // ‚ö°Ô∏è –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
        // ----------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
            }
            generateGrid();
        });

        saveNoteBtn.addEventListener('click', saveAndClose);
        closeModalBtn.addEventListener('click', () => {
            noteModal.style.display = 'none';
            currentCellKey = null;
        });

        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" —É Telegram, —è–∫—â–æ –≤–æ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.onEvent('backButtonClicked', saveAndClose);
        }
    </script>
</body>
</html>