drafts.html
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MORSTRIX | –ê—Ä—Ö—ñ–≤ (Pixel Art)</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°—Ç–∏–ª—ñ, –∞–¥–∞–ø—Ç–æ–≤–∞–Ω—ñ –ø—ñ–¥ –µ—Å—Ç–µ—Ç–∏–∫—É */
        :root {
            --bg-color: #000000; 
            --grid-color: #3a3a3a; 
            --text-color: #00ff00; 
            --accent-color: #ff00ff; 
            --draw-color: #ffffff; 
            --erase-color: #000000; 
            --cell-size: 15px; /* –ó–º–µ–Ω—à–µ–Ω–æ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—ñ—Ç–∫–∏ */
            --grid-dimension: 30; /* –†–æ–∑–º—ñ—Ä —Å—ñ—Ç–∫–∏ 30x30 */
        }

        body {
            font-family: monospace; /* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ monospace, —è–∫—â–æ "Press Start 2P" –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π */
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
            touch-action: pan-y;
            image-rendering: pixelated;
        }

        /* –ó–∞–≥–∞–ª—å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ */
        button {
            background-color: var(--accent-color);
            color: var(--bg-color);
            border: none;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 14px;
        }
        button:hover {
            opacity: 0.8;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }
        .tab-button {
            flex-grow: 1;
            background-color: #222;
            color: var(--text-color);
            border-bottom: 3px solid transparent;
            padding: 10px;
            margin: 0 5px;
        }
        .tab-button.active {
            background-color: var(--bg-color);
            border-bottom: 3px solid var(--accent-color);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è Pixel Art */
        #art-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #pixel-canvas {
            border: 2px solid var(--grid-color);
            background-color: var(--erase-color);
            cursor: crosshair;
            touch-action: none; /* –ó–∞–ø–æ–±—ñ–≥–∞—î –ø—Ä–æ–∫—Ä—É—á—É–≤–∞–Ω–Ω—é –ø—ñ–¥ —á–∞—Å –º–∞–ª—é–≤–∞–Ω–Ω—è */
            margin-bottom: 10px;
        }
        .art-controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        #color-picker {
            margin: 5px 15px;
            border: 2px solid var(--accent-color);
            background: var(--bg-color);
            height: 40px;
            width: 40px;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è Push/Reminder */
        .push-input-group {
            margin-bottom: 15px;
        }
        .push-input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--accent-color);
        }
        .push-input-group input[type="datetime-local"],
        .push-input-group textarea {
            width: 90%;
            padding: 10px;
            background-color: #111;
            border: 1px solid var(--grid-color);
            color: var(--text-color);
            font-size: 16px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="tab-buttons">
        <button id="tab-art-btn" class="tab-button active">Pixel Art</button>
        <button id="tab-push-btn" class="tab-button">–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (Push)</button>
    </div>

    <div id="art-tab" class="tab-content active">
        <h2>Pixel Art Helper</h2>
        <p>–ö–ª—é—á –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó —á–µ—Ä–Ω–µ—Ç–∫–∏: <span id="current-cell-key">ART_A</span></p>

        <div id="art-section">
            <canvas id="pixel-canvas"></canvas>
            <div class="art-controls">
                <input type="color" id="color-picker" value="#ffffff">
                <button id="toggle-tool-btn" data-tool="pen">‚úèÔ∏è Pen</button>
                <button id="clear-art-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
                <button id="send-art-btn">üì® –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ê—Ä—Ç</button>
            </div>
        </div>
    </div>

    <div id="push-tab" class="tab-content">
        <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è</h2>
        
        <div class="push-input-group">
            <label for="push-datetime">–î–∞—Ç–∞ —ñ –ß–∞—Å (–í–∞—à –ª–æ–∫–∞–ª—å–Ω–∏–π —á–∞—Å):</label>
            <input type="datetime-local" id="push-datetime">
        </div>
        
        <div class="push-input-group">
            <label for="push-text">–¢–µ–∫—Å—Ç –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è:</label>
            <textarea id="push-text" rows="4" placeholder="–ù–µ –∑–∞–±—É–¥—å –Ω–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–¥..."></textarea>
        </div>

        <button id="send-push-btn">‚è∞ –ó–∞–ø–ª–∞–Ω—É–≤–∞—Ç–∏ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è</button>
    </div>

    <button id="save-and-close-btn" style="width: 100%; margin-top: 20px;">–ó–∞–∫—Ä–∏—Ç–∏ Web App</button>

    <script>
        const GRID_DIMENSION = 30; 
        const CELL_SIZE = 10; // –ó–º–µ–Ω—à–µ–Ω–æ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è 30x30 –Ω–∞ –º–æ–±—ñ–ª—å–Ω–æ–º—É
        
        const canvas = document.getElementById('pixel-canvas');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('color-picker');
        const toggleToolBtn = document.getElementById('toggle-tool-btn');
        const clearArtBtn = document.getElementById('clear-art-btn');
        const sendArtBtn = document.getElementById('send-art-btn');
        const saveAndCloseBtn = document.getElementById('save-and-close-btn');

        const pushDateTime = document.getElementById('push-datetime');
        const pushText = document.getElementById('push-text');
        const sendPushBtn = document.getElementById('send-push-btn');
        const currentCellKeyElement = document.getElementById('current-cell-key');

        let pixelGrid;
        let isDrawing = false;
        let currentDrawColor = colorPicker.value;
        let currentTool = 'pen'; // 'pen' or 'eraser'
        let currentCellKey = 'ART_A'; // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–ª—é—á

        // --- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –õ–æ–≥—ñ–∫–∞ Art ---

        function generateGrid() {
            canvas.width = GRID_DIMENSION * CELL_SIZE;
            canvas.height = GRID_DIMENSION * CELL_SIZE;
        }

        function initPixelGrid() {
            pixelGrid = Array(GRID_DIMENSION).fill(0).map(() => Array(GRID_DIMENSION).fill(null));
        }

        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 1. –ú–∞–ª—é—î–º–æ –ø—ñ–∫—Å–µ–ª—ñ
            for (let y = 0; y < GRID_DIMENSION; y++) {
                for (let x = 0; x < GRID_DIMENSION; x++) {
                    const color = pixelGrid[y][x];
                    if (color) {
                        ctx.fillStyle = color;
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    }
                }
            }

            // 2. –ú–∞–ª—é—î–º–æ —Å—ñ—Ç–∫—É
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid-color');
            for (let i = 0; i <= GRID_DIMENSION; i++) {
                ctx.beginPath();
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó
                ctx.moveTo(i * CELL_SIZE, 0);
                ctx.lineTo(i * CELL_SIZE, canvas.height);
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ñ –ª—ñ–Ω—ñ—ó
                ctx.moveTo(0, i * CELL_SIZE);
                ctx.lineTo(canvas.width, i * CELL_SIZE);
                ctx.stroke();
            }
        }

        function getMousePos(event) {
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;

            if (event.touches) {
                // –û–±—Ä–æ–±–∫–∞ –¥–æ—Ç–∏–∫—É
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                // –û–±—Ä–æ–±–∫–∞ –º–∏—à—ñ
                clientX = event.clientX;
                clientY = event.clientY;
            }

            return {
                x: Math.floor((clientX - rect.left) / CELL_SIZE),
                y: Math.floor((clientY - rect.top) / CELL_SIZE)
            };
        }

        function drawPixel(x, y) {
            if (x >= 0 && x < GRID_DIMENSION && y >= 0 && y < GRID_DIMENSION) {
                const color = currentTool === 'pen' ? currentDrawColor : null; // null = erase
                pixelGrid[y][x] = color;
                redrawCanvas();
                saveArt(currentCellKey); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –º–∞–∑–∫–∞
            }
        }

        function handlePointerStart(event) {
            event.preventDefault(); 
            isDrawing = true;
            const pos = getMousePos(event);
            drawPixel(pos.x, pos.y);
        }

        function handlePointerMove(event) {
            if (!isDrawing) return;
            event.preventDefault();
            const pos = getMousePos(event);
            drawPixel(pos.x, pos.y);
        }

        function handlePointerEnd(event) {
            isDrawing = false;
        }

        function toggleTool() {
            if (currentTool === 'pen') {
                currentTool = 'eraser';
                toggleToolBtn.textContent = 'üßº Eraser';
                toggleToolBtn.dataset.tool = 'eraser';
                colorPicker.style.visibility = 'hidden';
            } else {
                currentTool = 'pen';
                toggleToolBtn.textContent = '‚úèÔ∏è Pen';
                toggleToolBtn.dataset.tool = 'pen';
                colorPicker.style.visibility = 'visible';
            }
        }

        colorPicker.addEventListener('input', (e) => {
            currentDrawColor = e.target.value;
            // –ü–µ—Ä–µ–º–∏–∫–∞—î–º–æ –Ω–∞ –ø–µ—Ä–æ, —è–∫—â–æ –æ–±—Ä–∞–Ω–æ –Ω–æ–≤–∏–π –∫–æ–ª—ñ—Ä
            if (currentTool === 'eraser') {
                 toggleTool();
            }
        });


        // --- –õ–æ–≥—ñ–∫–∞ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–∞ –í—ñ–¥–ø—Ä–∞–≤–∫–∏ ---
        
        function saveArt(key) {
            try {
                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ localStorage –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É
                localStorage.setItem(`morstrix_art_${key}`, JSON.stringify(pixelGrid));
            } catch (e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Local Storage:", e);
            }
        }

        function loadArt(key) {
            try {
                const savedData = localStorage.getItem(`morstrix_art_${key}`);
                if (savedData) {
                    pixelGrid = JSON.parse(savedData);
                } else {
                    initPixelGrid(); // –°–∫–∏–¥–∞—î–º–æ, —è–∫—â–æ –Ω–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö
                }
            } catch (e) {
                initPixelGrid(); // –°–∫–∏–¥–∞—î–º–æ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –ø–∞—Ä—Å–∏–Ω–≥—É
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Local Storage:", e);
            }
        }

        function updateCellDisplay(newKey) {
            currentCellKey = newKey;
            currentCellKeyElement.textContent = newKey;
            loadArt(currentCellKey);
            redrawCanvas();
        }

        function sendArt() {
            // 1. –û—á–∏—â–∞—î–º–æ –ø—É—Å—Ç—ñ —Ä—è–¥–∫–∏ —ñ —Å—Ç–æ–≤–ø—Ü—ñ, —â–æ–± –∑–º–µ–Ω—à–∏—Ç–∏ JSON payload
            // (–¶—é –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏, –∞–ª–µ –∫—Ä–∞—â–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —á–∏—Å—Ç—É —Å—ñ—Ç–∫—É)
            
            const payload = JSON.stringify(pixelGrid);
            
            // –§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö: "ART|CELL_KEY|JSON_PAYLOAD"
            const data = `ART|${currentCellKey}|${payload}`;

            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(data);
                window.Telegram.WebApp.close();
            } else {
                 alert(`ART Data Sent (debug): ${data}`);
            }
        }

        function sendPush() {
            const dateTime = pushDateTime.value;
            const text = pushText.value.trim();
            const key = `PUSH_${Date.now()}`; // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á –¥–ª—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è

            if (!dateTime) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —ñ —á–∞—Å.");
                return;
            }
            if (!text) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è.");
                return;
            }

            const payload = JSON.stringify({
                text: text,
                datetime: dateTime // –ù–∞–¥—Å–∏–ª–∞—î–º–æ —Ä—è–¥–æ–∫ —É —Ñ–æ—Ä–º–∞—Ç—ñ ISO 8601
            });
            
            // –§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö: "PUSH|UNIQUE_KEY|JSON_PAYLOAD"
            const data = `PUSH|${key}|${payload}`;

            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(data);
                window.Telegram.WebApp.close();
            } else {
                alert(`PUSH Data Sent (debug): ${data}`);
            }
        }


        function saveAndClose() {
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –∞—Ä—Ç –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º
            saveArt(currentCellKey);
            
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.close();
            } else {
                alert("Closed (debug)");
            }
        }


        // --- –õ–æ–≥—ñ–∫–∞ –í–∫–ª–∞–¥–æ–∫ ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tabId.replace('-tab', '')}-btn`).classList.add('active');
        }

        document.getElementById('tab-art-btn').addEventListener('click', () => switchTab('art-tab'));
        document.getElementById('tab-push-btn').addEventListener('click', () => switchTab('push-tab'));


        // --- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ---
        window.addEventListener('load', () => {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.BackButton.hide();
            }
            
            // Art Init
            generateGrid();
            updateCellDisplay(currentCellKey); // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –∞—Ä—Ç —Ç–∞ –º–∞–ª—é—î
            
            // Push Init
            const now = new Date();
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ —Ç–µ–ø–µ—Ä—ñ—à–Ω—ñ–π —á–∞—Å (–¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –±—Ä–∞—É–∑–µ—Ä—ñ–≤)
            pushDateTime.min = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            pushDateTime.value = pushDateTime.min; 


            // –û–±—Ä–æ–±–Ω–∏–∫–∏ Art (–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —è–∫ –º–∏—à—ñ, —Ç–∞–∫ —ñ –¥–æ—Ç–∏–∫—É)
            canvas.addEventListener('mousedown', handlePointerStart);
            canvas.addEventListener('mousemove', handlePointerMove);
            document.addEventListener('mouseup', handlePointerEnd);
            
            canvas.addEventListener('touchstart', handlePointerStart);
            canvas.addEventListener('touchmove', handlePointerMove);
            canvas.addEventListener('touchend', handlePointerEnd);
            
            clearArtBtn.addEventListener('click', () => {
                if(confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å –∞—Ä—Ç?")) {
                    initPixelGrid();
                    redrawCanvas();
                    saveArt(currentCellKey);
                }
            });
            
            toggleToolBtn.addEventListener('click', toggleTool);

            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            saveAndCloseBtn.addEventListener('click', saveAndClose);
            sendArtBtn.addEventListener('click', sendArt); 
            sendPushBtn.addEventListener('click', sendPush); // ‚úÖ –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ Push

            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.onEvent('backButtonClicked', saveAndClose);
            }
        });
    </script>
</body>
</html>