drafts.html
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MORSTRIX | –ê—Ä—Ö—ñ–≤ (Pixel Art)</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #000000; /* –ß–æ—Ä–Ω–∏–π —Ñ–æ–Ω */
            --grid-color: #004d40; /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω–∏–π –¥–ª—è —Å—ñ—Ç–∫–∏ */
            --text-color: #00ff00; /* –Ø—Å–∫—Ä–∞–≤–æ-–∑–µ–ª–µ–Ω–∏–π –¥–ª—è —Ç–µ–∫—Å—Ç—É (Pixel) */
            --accent-color: #ff00ff; /* –ú–∞–¥–∂–µ–Ω—Ç–∞ –¥–ª—è –∞–∫—Ü–µ–Ω—Ç—É (Retro) */
            --cell-size: 80px;
        }

        body {
            font-family: 'Press Start 2P', monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            touch-action: pan-y;
            image-rendering: pixelated;
        }
        
        @supports not (font-family: 'Press Start 2P') {
             body {
                font-family: monospace;
            }
        }

        .header {
            text-align: center;
            padding: 10px;
            background-color: var(--grid-color);
            color: #fff;
            box-shadow: 0 4px 0 var(--accent-color);
            margin-bottom: 5px;
            text-shadow: 2px 2px 0 #000;
        }

        .grid-container {
            /* 4 –ö–û–õ–û–ù–ö–ò */
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 1px; 
            padding: 10px;
            background-color: var(--grid-color); 
        }

        .cell {
            min-height: var(--cell-size);
            background-color: var(--bg-color);
            border: 1px solid var(--grid-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.1s;
            text-align: center;
            padding: 5px;
            font-size: 10px;
        }

        .cell:hover {
            background-color: #001a14;
        }

        .note-indicator {
            color: var(--accent-color);
            font-size: 14px;
            text-shadow: 1px 1px 0 #000;
            margin-top: 5px;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98); /* –¢—Ä–æ—Ö–∏ –ø—Ä–æ–∑–æ—Ä—ñ—à–µ –¥–ª—è –µ—Ñ–µ–∫—Ç—É */
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            width: 95%;
            max-width: 600px;
            height: 80vh; /* –ó–±—ñ–ª—å—à—É—î–º–æ –≤–∏—Å–æ—Ç—É */
            background: var(--bg-color);
            border: 2px solid var(--text-color);
            padding: 20px;
            box-shadow: 4px 4px 0 var(--accent-color);
            display: flex;
            flex-direction: column;
        }
        
        /* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –ù–û–¢–ê–¢–û–ö (–ù–û–í–ò–ô) */
        .note-list-container {
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid var(--grid-color);
            margin-bottom: 10px;
            padding: 10px;
            background-color: #000000;
        }

        .note-item {
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px dotted var(--text-color);
            font-size: 14px;
            word-break: break-all;
            white-space: pre-wrap; /* –ó–±–µ—Ä—ñ–≥–∞—î —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É */
        }
        
        .note-item:last-child {
            border-bottom: none;
        }

        textarea {
            width: 100%;
            height: 100px; /* –ó–º–µ–Ω—à—É—î–º–æ –≤–∏—Å–æ—Ç—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–≤–æ–¥—É */
            background-color: #000000;
            color: var(--text-color);
            border: 1px solid var(--grid-color);
            padding: 10px;
            box-sizing: border-box;
            resize: vertical; /* –î–æ–∑–≤–æ–ª—è—î–º–æ –ª–∏—à–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É –∑–º—ñ–Ω—É —Ä–æ–∑–º—ñ—Ä—É */
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –Ω–æ—Ç–∞—Ç–∫–∏ */
        .add-note-btn {
            background-color: #004d40;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            box-shadow: 1px 1px 0 #000;
            margin-bottom: 10px;
        }
        
        .add-note-btn:hover {
            background-color: var(--text-color);
            color: var(--bg-color);
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: auto; /* –ü—Ä–∏—Ç–∏—Å–∫–∞—î–º–æ –¥–æ –Ω–∏–∑—É */
        }

        .close-btn, .save-btn, .send-btn {
            background-color: var(--accent-color);
            color: var(--bg-color);
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            box-shadow: 2px 2px 0 #000;
            flex-grow: 1; 
        }
        
        .save-btn {
            background-color: var(--text-color);
        }

        .send-btn {
            background-color: #ff9900;
        }
    </style>
</head>
<body>

    <div class="header">
        MORSTRIX ARCHIVE V2.0
    </div>

    <div id="grid-container" class="grid-container">
        </div>

    <div id="noteModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">–ö—ñ–º–Ω–∞—Ç–∞ [X, Y]</h2>
            
            <div id="noteListContainer" class="note-list-container">
                </div>
            
            <textarea id="noteContent" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –Ω–æ—Ç–∞—Ç–∫—É –∞–±–æ –∞—Ä—Ç (–æ–¥–∏–Ω –∑–∞–ø–∏—Å)..."></textarea>
            
            <button id="addNoteBtn" class="add-note-btn">–î–û–î–ê–¢–ò –ù–û–¢–ê–¢–ö–£</button>

            <div class="button-group">
                <button id="saveNoteBtn" class="save-btn">–ó–ë–ï–†–ï–ì–¢–ò –í–°–ï</button>
                <button id="sendNoteBtn" class="send-btn">–ù–ê–î–Ü–°–õ–ê–¢–ò –û–°–¢–ê–ù–ù–Ñ</button>
                <button id="closeModalBtn" class="close-btn">–ó–ê–ö–†–ò–¢–ò</button>
            </div>
        </div>
    </div>

    <script>
        const GRID_ROWS = 7; // 7 –†–Ø–î–ö–Ü–í
        const GRID_COLS = 4; // 4 –ö–û–õ–û–ù–ö–ò
        const gridContainer = document.getElementById('grid-container');
        const noteModal = document.getElementById('noteModal');
        const modalTitle = document.getElementById('modalTitle');
        const noteContentInput = document.getElementById('noteContent'); // –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞–∑–≤—É
        const noteListContainer = document.getElementById('noteListContainer'); // –ù–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç
        const addNoteBtn = document.getElementById('addNoteBtn'); // –ù–æ–≤–∞ –∫–Ω–æ–ø–∫–∞
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const sendNoteBtn = document.getElementById('sendNoteBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');

        let currentCellKey = null;
        let allNotes = loadNotes();

        // ----------------------------------------------------
        // üíæ LOCAL STORAGE –§–£–ù–ö–¶–Ü–á
        // ----------------------------------------------------

        function loadNotes() {
            try {
                const data = localStorage.getItem('morstrix_drafts_v2'); // –ó–º—ñ–Ω–µ–Ω–æ –∫–ª—é—á
                return data ? JSON.parse(data) : {};
            } catch (e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è LocalStorage:", e);
                return {};
            }
        }

        function saveNotes() {
            try {
                localStorage.setItem('morstrix_drafts_v2', JSON.stringify(allNotes));
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                }
            } catch (e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è LocalStorage:", e);
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
                }
            }
        }
        
        // ----------------------------------------------------
        // üèóÔ∏è –ì–ï–ù–ï–†–ê–¶–Ü–Ø –°–Ü–¢–ö–ò –¢–ê –õ–û–ì–Ü–ö–ê
        // ----------------------------------------------------

        function generateGrid() {
            gridContainer.innerHTML = '';
            for (let row = 1; row <= GRID_ROWS; row++) {
                for (let col = 1; col <= GRID_COLS; col++) {
                    const cellKey = `cell_${row}_${col}`;
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'cell';
                    cellDiv.dataset.key = cellKey;
                    
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –Ω–æ—Ç–∞—Ç–∫–∏ –¥–ª—è —Ü—ñ—î—ó –∫–ª—ñ—Ç–∏–Ω–∫–∏ (—Ç–µ–ø–µ—Ä —Ü–µ –º–∞—Å–∏–≤)
                    const noteArray = allNotes[cellKey];
                    const count = noteArray ? noteArray.length : 0;
                    const hasNote = count > 0;

                    cellDiv.innerHTML = `[${row}, ${col}] ${hasNote ? `<div class="note-indicator">‚ö°Ô∏è(${count})</div>` : ''}`;
                    cellDiv.addEventListener('click', () => openCell(cellKey, row, col));
                    gridContainer.appendChild(cellDiv);
                }
            }
        }

        function renderNoteList(cellKey) {
            noteListContainer.innerHTML = '';
            const notes = allNotes[cellKey] || [];
            
            if (notes.length === 0) {
                noteListContainer.innerHTML = '<div style="color: #999; text-align: center; margin-top: 20px;">–ù–æ—Ç–∞—Ç–æ–∫ –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—É!</div>';
                return;
            }

            notes.forEach((note, index) => {
                const noteItem = document.createElement('div');
                noteItem.className = 'note-item';
                // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –Ω–æ—Ç–∞—Ç–∫—É —Ç–∞ –¥–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è
                noteItem.innerHTML = `<span style="color: var(--accent-color);">${index + 1}.</span> ${note} <button onclick="deleteNote('${cellKey}', ${index})" style="float: right; background: red; color: white; border: none; padding: 2px 5px; cursor: pointer; font-family: monospace;">X</button>`;
                noteListContainer.appendChild(noteItem);
            });
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–æ—Ç–∞—Ç–∫–∏
        window.deleteNote = (cellKey, index) => {
            if (allNotes[cellKey] && allNotes[cellKey].length > index) {
                allNotes[cellKey].splice(index, 1);
                
                // –Ø–∫—â–æ –º–∞—Å–∏–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π, –≤–∏–¥–∞–ª—è—î–º–æ –∫–ª—é—á –∫–ª—ñ—Ç–∏–Ω–∫–∏
                if (allNotes[cellKey].length === 0) {
                    delete allNotes[cellKey];
                }
                
                renderNoteList(cellKey);
                updateCellDisplay(cellKey);
                saveNotes();
            }
        };

        function openCell(cellKey, row, col) {
            currentCellKey = cellKey;
            modalTitle.textContent = `–ö—ñ–º–Ω–∞—Ç–∞ [${row}, ${col}]`;
            
            noteContentInput.value = ''; // –û—á–∏—â—É—î–º–æ –ø–æ–ª–µ –≤–≤–æ–¥—É
            renderNoteList(cellKey); // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ –Ω–æ—Ç–∞—Ç–æ–∫
            
            noteModal.style.display = 'flex';
            
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.expand();
                window.Telegram.WebApp.BackButton.show();
            }
        }
        
        function addNote() {
            if (currentCellKey) {
                const content = noteContentInput.value.trim();
                if (content === '') {
                    alert("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –Ω–æ—Ç–∞—Ç–∫–∏ –∞–±–æ –∞—Ä—Ç –ø–µ—Ä–µ–¥ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º.");
                    return;
                }
                
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –º–∞—Å–∏–≤, —è–∫—â–æ –≤—ñ–Ω —â–µ –Ω–µ —ñ—Å–Ω—É—î
                if (!allNotes[currentCellKey]) {
                    allNotes[currentCellKey] = [];
                }
                
                allNotes[currentCellKey].push(content);
                noteContentInput.value = ''; // –û—á–∏—â—É—î–º–æ –ø–æ–ª–µ
                renderNoteList(currentCellKey); // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫
                updateCellDisplay(currentCellKey); // –û–Ω–æ–≤–ª—é—î–º–æ –≤–∏–≥–ª—è–¥ —Å—ñ—Ç–∫–∏
                saveNotes(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ
            }
        }

        function updateCellDisplay(cellKey) {
            const row = cellKey.split('_')[1];
            const col = cellKey.split('_')[2];
            const currentCellDiv = document.querySelector(`.cell[data-key="${cellKey}"]`);
            if (currentCellDiv) {
                const count = allNotes[cellKey] ? allNotes[cellKey].length : 0;
                const hasNote = count > 0;
                currentCellDiv.innerHTML = `[${row}, ${col}] ${hasNote ? `<div class="note-indicator">‚ö°Ô∏è(${count})</div>` : ''}`;
            }
        }

        function saveAllAndClose() {
            // –£ V2.0 –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ 'addNote' —Ç–∞ 'deleteNote'
            // –¢—É—Ç –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä–∏–≤–∞—î–º–æ
            currentCellKey = null;
            closeModal();
        }

        function closeModal() {
            noteModal.style.display = 'none';
            currentCellKey = null;
            if (window.Telegram && window.Telegram.WebApp) {
                 window.Telegram.WebApp.BackButton.hide(); 
            }
        }

        function sendNote() {
            if (currentCellKey) {
                const notes = allNotes[currentCellKey] || [];
                if (notes.length === 0) {
                    alert("–£ —Ü—ñ–π –∫—ñ–º–Ω–∞—Ç—ñ –Ω–µ–º–∞—î –Ω–æ—Ç–∞—Ç–æ–∫ –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è.");
                    return;
                }
                
                // –ù–∞–¥—Å–∏–ª–∞—î–º–æ –æ—Å—Ç–∞–Ω–Ω—é –Ω–æ—Ç–∞—Ç–∫—É (–∞–±–æ –æ–±'—î–¥–Ω–∞–Ω–∏–π —Ç–µ–∫—Å—Ç)
                const lastNote = notes[notes.length - 1]; 
                
                if (window.Telegram && window.Telegram.WebApp) {
                    // –ù–∞–¥—Å–∏–ª–∞—î–º–æ –æ—Å—Ç–∞–Ω–Ω—é –Ω–æ—Ç–∞—Ç–∫—É
                    window.Telegram.WebApp.sendData(lastNote);
                    // –í–∏–¥–∞–ª—è—î–º–æ —ó—ó –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                    allNotes[currentCellKey].pop();
                    if (allNotes[currentCellKey].length === 0) {
                         delete allNotes[currentCellKey];
                    }
                    saveNotes();
                    closeModal();
                    
                    if (window.Telegram.WebApp.isClosing) return; // –£–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏, —è–∫—â–æ –¥–æ–¥–∞—Ç–æ–∫ –≤–∂–µ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è
                    updateCellDisplay(currentCellKey);
                    
                } else {
                    alert("–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ Telegram WebApp API.");
                }
            }
        }

        // ----------------------------------------------------
        // ‚ö°Ô∏è –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
        // ----------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.BackButton.hide();
            }
            generateGrid();
        });

        addNoteBtn.addEventListener('click', addNote);
        saveNoteBtn.addEventListener('click', saveAllAndClose);
        sendNoteBtn.addEventListener('click', sendNote); 
        closeModalBtn.addEventListener('click', closeModal); 

        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" —É Telegram
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.onEvent('backButtonClicked', saveAllAndClose);
        }
    </script>
</body>
</html>